<div id="smart-chatbot" style="position: fixed; bottom: 30px; right: 30px; z-index: 9999; font-family: 'Montserrat', sans-serif;">
    <div id="chat-bubble" onclick="openChat()" style="background: var(--acca-red); width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 10px 25px rgba(227,30,36,0.4); transition: 0.4s;">
        <i class="fas fa-robot" style="color: white; font-size: 28px;"></i>
    </div>

    <div id="chat-box" style="display: none; width: 350px; height: 500px; background: white; border-radius: 25px; box-shadow: 0 15px 50px rgba(0,0,0,0.2); flex-direction: column; overflow: hidden; position: absolute; bottom: 80px; right: 0; border: 1px solid #eee; animation: slideUp 0.4s ease;">
        <div style="background: var(--navy); padding: 20px; color: white; display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 10px; height: 10px; background: #2ecc71; border-radius: 50%;"></div>
                <span style="font-weight: 800; letter-spacing: 1px;">ACCA AI AGENT</span>
            </div>
            <i class="fas fa-times" onclick="closeChat()" style="cursor: pointer; opacity: 0.7;"></i>
        </div>

        <div id="chat-content" style="flex: 1; padding: 20px; overflow-y: auto; background: #fdfdfd; display: flex; flex-direction: column; gap: 15px;">
            <div class="ai-msg" style="background: #f1f1f1; padding: 12px 18px; border-radius: 15px 15px 15px 0; max-width: 85%; align-self: flex-start; font-size: 0.9rem; color: #333; line-height: 1.5;">
                Asc! ðŸ‘‹ Waxaan ahay kaaliyahaaga dhijitaalka ah. Ma ku caawiyaa inaan iska diiwaangeliso ACCA?
            </div>
        </div>

        <div id="chat-options" style="padding: 10px; display: flex; gap: 8px; flex-wrap: wrap; background: #fff; border-top: 1px solid #eee;">
            <button onclick="startFlow('apply')" style="background: white; border: 1.5px solid var(--acca-red); color: var(--acca-red); padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 0.75rem; font-weight: 700;">Haa, is-diiwaangeli</button>
            <button onclick="startFlow('price')" style="background: white; border: 1.5px solid #777; color: #555; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 0.75rem;">Qiimaha</button>
        </div>
    </div>
</div>

<style>
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .typing { font-style: italic; font-size: 0.8rem; color: #999; }
</style>

<script>
    let userData = { name: "", level: "" };
    const chatContent = document.getElementById('chat-content');

    function openChat() { document.getElementById('chat-box').style.display = 'flex'; }
    function closeChat() { document.getElementById('chat-box').style.display = 'none'; }

    function addMessage(text, type) {
        const msg = document.createElement('div');
        msg.style = type === 'ai' 
            ? "background: #f1f1f1; padding: 12px 18px; border-radius: 15px 15px 15px 0; max-width: 85%; align-self: flex-start; font-size: 0.9rem; color: #333;" 
            : "background: var(--navy); padding: 12px 18px; border-radius: 15px 15px 0 15px; max-width: 85%; align-self: flex-end; font-size: 0.9rem; color: white;";
        msg.innerHTML = text;
        chatContent.appendChild(msg);
        chatContent.scrollTop = chatContent.scrollHeight;
    }

    function startFlow(type) {
        if(type === 'price') {
            addMessage("Qiimaha", 'user');
            setTimeout(() => addMessage("Heerka Knowledge waa **$150**, Skills-kana waa **$250**. Ma rabtaa inaan hadda ku diiwaangeliyo?", 'ai'), 800);
        } else if(type === 'apply') {
            addMessage("Haa, is-diiwaangeli", 'user');
            document.getElementById('chat-options').innerHTML = ""; // Clear options
            setTimeout(() => {
                addMessage("Waa gartay! Fadlan qor **Magacaaga oo buuxa** hoos:", 'ai');
                createInput("Magacaaga...");
            }, 800);
        }
    }

    function createInput(placeholder) {
        const inputDiv = document.createElement('div');
        inputDiv.style = "padding: 10px; border-top: 1px solid #eee; display: flex;";
        inputDiv.innerHTML = `<input type="text" id="ai-input" placeholder="${placeholder}" style="flex:1; border:none; outline:none; font-family:Montserrat;">
                              <button onclick="handleInput()" style="background:var(--acca-red); color:white; border:none; padding:10px 15px; border-radius:10px; cursor:pointer;"><i class="fas fa-paper-plane"></i></button>`;
        document.getElementById('chat-box').appendChild(inputDiv);
    }

    function handleInput() {
        const val = document.getElementById('ai-input').value;
        if(!val) return;
        
        if(!userData.name) {
            userData.name = val;
            addMessage(val, 'user');
            document.getElementById('ai-input').value = "";
            setTimeout(() => addMessage(`Mahadsanid **${val}**. Heerkee rabtaa: **Knowledge** mise **Skills**?`, 'ai'), 800);
        } else {
            userData.level = val;
            addMessage(val, 'user');
            setTimeout(() => {
                addMessage("Nidaamka waa diyaar! Guji badhanka hoose si aad WhatsApp-ka ugu dhammaystirto.", 'ai');
                const link = `https://wa.me/252613040087?text=${encodeURIComponent('Asc, Magacaygu waa ' + userData.name + '. Waxaan rabaa is-diiwaangelin heerka ' + userData.level)}`;
                addMessage(`<a href="${link}" target="_blank" style="background:#25D366; color:white; padding:10px; text-decoration:none; border-radius:10px; display:block; text-align:center; font-weight:bold;">DHAMMAYSTIR WHATSAPP-KA</a>`, 'ai');
            }, 1000);
        }
    }
</script>
